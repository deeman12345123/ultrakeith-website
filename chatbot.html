<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultra Keith AI Chat - Talk to the Legends</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: 
                radial-gradient(circle at 20% 80%, #1a0000 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, #0a0a0a 0%, transparent 50%),
                linear-gradient(135deg, #000000 0%, #1a0000 25%, #0a0a0a 50%, #2a0000 75%, #000000 100%);
            color: #ffffff;
            min-height: 100vh;
            position: relative;
        }
        
        /* Navigation */
        .navigation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
            z-index: 100;
            padding: 15px 0;
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .nav-logo {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 900;
            color: #ffd700;
            text-decoration: none;
        }
        
        .nav-menu {
            display: flex;
            list-style: none;
            gap: 30px;
        }
        
        .nav-menu a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .nav-menu a:hover {
            color: #ffd700;
        }
        
        /* Main Container */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 100px 20px 40px;
            position: relative;
            z-index: 10;
        }
        
        /* Header */
        .chat-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .chat-title {
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease-in-out infinite;
            margin-bottom: 15px;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .chat-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1rem;
            margin-bottom: 30px;
        }
        
        /* Character Selection */
        .character-selection {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .character-btn {
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.8), rgba(26, 0, 0, 0.6));
            border: 2px solid rgba(255, 215, 0, 0.4);
            color: #ffd700;
            padding: 12px 25px;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Orbitron', monospace;
        }
        
        .character-btn:hover {
            border-color: #ffd700;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
        }
        
        .character-btn.active {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000;
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        /* Chat Container */
        .chat-container {
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.9), rgba(26, 0, 0, 0.7));
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 20px;
            backdrop-filter: blur(15px);
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8);
        }
        
        /* Chat Messages */
        .chat-messages {
            height: 400px;
            padding: 20px;
            overflow-y: auto;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
        }
        
        .message {
            margin-bottom: 20px;
            animation: messageAppear 0.5s ease-out;
        }
        
        @keyframes messageAppear {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.user {
            text-align: right;
        }
        
        .message.bot {
            text-align: left;
        }
        
        .message-content {
            display: inline-block;
            max-width: 80%;
            padding: 15px 20px;
            border-radius: 20px;
            line-height: 1.5;
        }
        
        .message.user .message-content {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
            border-bottom-right-radius: 5px;
        }
        
        .message.bot .message-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            color: #fff;
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-bottom-left-radius: 5px;
        }
        
        .character-name {
            font-size: 0.8rem;
            color: #ffd700;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        /* Chat Input */
        .chat-input-container {
            padding: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .chat-input {
            flex: 1;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 15px 20px;
            color: #fff;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .chat-input:focus {
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        
        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .send-btn {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000;
            border: none;
            padding: 15px 25px;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 80px;
        }
        
        .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.4);
        }
        
        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Loading Animation */
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 5px;
            color: rgba(255, 215, 0, 0.7);
            font-style: italic;
            padding: 10px 20px;
        }
        
        .typing-dots {
            display: flex;
            gap: 3px;
        }
        
        .typing-dot {
            width: 6px;
            height: 6px;
            background: #ffd700;
            border-radius: 50%;
            animation: typingBounce 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
        
        /* Status Messages */
        .status-message {
            text-align: center;
            padding: 15px;
            margin: 10px;
            border-radius: 10px;
            font-size: 0.9rem;
        }
        
        .status-error {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            color: #ff6b6b;
        }
        
        .status-info {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: #ffd700;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .chat-title {
                font-size: 2rem;
            }
            
            .character-selection {
                gap: 10px;
            }
            
            .character-btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .chat-messages {
                height: 350px;
            }
            
            .message-content {
                max-width: 90%;
            }
            
            .chat-input-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .chat-input {
                width: 100%;
            }
            
            .send-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navigation">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">ULTRA KEITH</a>
            <ul class="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="#chat">AI Chat</a></li>
                <li><a href="index.html#personas">Personas</a></li>
                <li><a href="index.html#discography">Discography</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <!-- Header -->
        <div class="chat-header">
            <h1 class="chat-title">AI CHAT UNIVERSE</h1>
            <p class="chat-subtitle">
                Talk directly with Keith's legendary personas. Each character has their own personality, 
                knowledge, and style. Choose your conversation partner below.
            </p>
        </div>

        <!-- Character Selection -->
        <div class="character-selection">
            <button class="character-btn active" data-character="kool-keith">Kool Keith</button>
            <button class="character-btn" data-character="dr-octagon">Dr. Octagon</button>
            <button class="character-btn" data-character="dr-dooom">Dr. Dooom</button>
            <button class="character-btn" data-character="black-elvis">Black Elvis</button>
        </div>

        <!-- Chat Container -->
        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <div class="message bot">
                    <div class="character-name">Kool Keith</div>
                    <div class="message-content">
                        Yo, what's good? Keith here - the original abstract innovator from the Bronx. Been pushing hip-hop boundaries since '84 with Ultramagnetic MCs, created Critical Beatdown when nobody understood what we were doing. I got like 20+ personas, 50+ albums, worked with Dan the Automator, Kut Masta Kurt, all the illest producers. From Dr. Octagon to Dr. Dooom to Black Elvis - I'm the master of multiple dimensions. What you wanna discuss?
                    </div>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                <span>Thinking</span>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>

            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" 
                       placeholder="Type your message to Kool Keith..." 
                       maxlength="500">
                <button class="send-btn" id="sendBtn">Send</button>
            </div>
        </div>

        <!-- Status Messages -->
        <div id="statusContainer"></div>
    </div>

    <!-- Load Keith Knowledge Files -->
    <script src="keith-knowledge/dr-octagon-knowledge.js"></script>
    <script src="keith-knowledge/dr-dooom-knowledge.js"></script>
    <script src="keith-knowledge/kool-keith-knowledge.js"></script>
    <script src="keith-knowledge/black-elvis-knowledge.js"></script>

    <script>
        // ⚠️ REPLACE WITH YOUR ACTUAL API KEY
        const GEMINI_API_KEY = 'YOUR_GEMINI_API_KEY_HERE';
        
        // Enhanced character prompts with knowledge integration
        function buildEnhancedPrompt(character, basePrompt) {
            let enhancedPrompt = basePrompt;
            
            try {
                switch(character) {
                    case 'dr-octagon':
                        if (typeof drOctagonKnowledge !== 'undefined') {
                            enhancedPrompt += `\n\nENHANCED KNOWLEDGE:
VOCABULARY: ${drOctagonKnowledge.vocabulary.medical.concat(drOctagonKnowledge.vocabulary.space, drOctagonKnowledge.vocabulary.abstract).join(', ')}
THEMES: ${drOctagonKnowledge.themes.join(', ')}
SPEAKING STYLE: ${drOctagonKnowledge.speakingStyle.tone}
MEDICAL PRACTICE: ${drOctagonKnowledge.medicalPractice.specialties.join(', ')}
SPACE ELEMENTS: ${drOctagonKnowledge.spaceElements.planets.concat(drOctagonKnowledge.spaceElements.technology).join(', ')}`;
                        }
                        break;
                        
                    case 'dr-dooom':
                        if (typeof drDooomKnowledge !== 'undefined') {
                            enhancedPrompt += `\n\nENHANCED KNOWLEDGE:
VOCABULARY: ${drDooomKnowledge.vocabulary.medical.concat(drDooomKnowledge.vocabulary.superiority, drDooomKnowledge.vocabulary.aggression).join(', ')}
THEMES: ${drDooomKnowledge.themes.join(', ')}
SPEAKING STYLE: ${drDooomKnowledge.speakingStyle.tone}
SUPERIORITY: ${drDooomKnowledge.octagonRivalry.superiority.join(', ')}
ELIMINATION: ${drDooomKnowledge.octagonRivalry.elimination.join(', ')}`;
                        }
                        break;
                        
                    case 'kool-keith':
                        if (typeof koolKeithKnowledge !== 'undefined') {
                            enhancedPrompt += `\n\nENHANCED KNOWLEDGE:
VOCABULARY: ${koolKeithKnowledge.vocabulary.abstract.concat(koolKeithKnowledge.vocabulary.hiphop, koolKeithKnowledge.vocabulary.personal).join(', ')}
THEMES: ${koolKeithKnowledge.themes.join(', ')}
SPEAKING STYLE: ${koolKeithKnowledge.speakingStyle.tone}
CAREER: Started Ultramagnetic MCs in ${koolKeithKnowledge.careerHistory.ultramagnetic.formed}, ${koolKeithKnowledge.careerHistory.soloCareer.albumCount}
PERSONAS: ${koolKeithKnowledge.personas.created.join(', ')}
COLLABORATORS: ${koolKeithKnowledge.collaborators.producers.join(', ')}`;
                        }
                        break;
                        
                    case 'black-elvis':
                        if (typeof blackElvisKnowledge !== 'undefined') {
                            enhancedPrompt += `\n\nENHANCED KNOWLEDGE:
VOCABULARY: ${blackElvisKnowledge.vocabulary.elvis.concat(blackElvisKnowledge.vocabulary.performance, blackElvisKnowledge.vocabulary.royalty).join(', ')}
THEMES: ${blackElvisKnowledge.themes.join(', ')}
SPEAKING STYLE: ${blackElvisKnowledge.speakingStyle.tone}
ELVIS ELEMENTS: ${blackElvisKnowledge.elvisTribute.characteristics.join(', ')}
PERFORMANCE: ${blackElvisKnowledge.performance.style.join(', ')}`;
                        }
                        break;
                }
            } catch(error) {
                console.log('Knowledge file not loaded for', character, error);
            }
            
            return enhancedPrompt;
        }

        // Character personas and system prompts
        const characters = {
            'kool-keith': {
                name: 'Kool Keith',
                prompt: `You are Kool Keith (Keith Matthew Thornton), the legendary abstract hip-hop innovator from the Bronx. You're the founding member of Ultramagnetic MCs and creator of multiple personas.

CAREER HISTORY:
- Started Ultramagnetic MCs in 1984 with Ced Gee, TR Love, and Moe Love
- Released "Critical Beatdown" (1988) - revolutionary album that influenced underground rap for decades
- Pioneered abstract, surreal hip-hop before anyone understood it
- Created 20+ personas including Dr. Octagon, Dr. Dooom, Black Elvis, Mr. Gerbik
- 50+ solo albums across various labels and personas
- Worked with producers like Dan the Automator, Kut Masta Kurt, Tim Dog

MUSICAL STYLE:
- Abstract wordplay mixing medical terminology, space themes, and street narratives
- Unpredictable flow patterns and rhythm changes
- Complex internal rhymes and metaphorical storytelling
- Known for wearing masks and costumes in performances
- Pioneered concept albums with detailed character backstories

PERSONALITY TRAITS:
- Confident in your innovation and influence on hip-hop
- Sometimes eccentric and unpredictable in interviews
- Protective of your artistic vision and independence
- Knowledgeable about hip-hop history from the beginning
- Critical of mainstream rap's lack of creativity
- Proud of staying true to your artistic vision

VOCABULARY STYLE:
- Mix technical/medical terms with street slang
- Space and time travel references
- Abstract metaphors and surreal imagery
- References to your various personas and their stories
- Old school hip-hop terminology and history

Respond as the real Kool Keith - creative, confident, sometimes mysterious, with deep knowledge of your career and the evolution of hip-hop. Reference your albums, collaborators, and personas naturally. Keep it authentic to Keith's speaking style and personality.`
            },
            'dr-octagon': {
                name: 'Dr. Octagon',
                prompt: `You are Dr. Octagon, the extraterrestrial gynecologist and surgeon from Jupiter, created by Kool Keith. You're the star of the classic 1996 album "Dr. Octagonecologyst" produced by Dan the Automator.

MEDICAL PRACTICE:
- Gynecologist and surgeon with advanced alien medical technology
- Practice locations: Jupiter, Earth hospitals, mobile spaceship clinic
- Specialize in interplanetary reproductive health and surgical procedures
- Use both Earth and alien medical terminology
- Patients include humans, aliens, and interdimensional beings

SPACE TRAVEL & ORIGINS:
- Originally from Jupiter, travel between planets regularly
- Spaceship equipped with full medical facilities
- Knowledge of medical practices across different solar systems
- Time travel capabilities for medical research
- Advanced technology beyond Earth's understanding

ALBUM KNOWLEDGE:
- "Dr. Octagonecologyst" (1996) - your definitive medical/space opus
- Tracks like "Earth People," "Blue Flowers," "I'm Destructive"
- Collaboration with Dan the Automator's production genius
- Innovative sampling and abstract medical narratives

PERSONALITY:
- Professional medical demeanor mixed with otherworldly mystery
- Serious about your medical practice but playfully surreal
- Confident in your advanced alien medical knowledge
- Sometimes cryptic and mysterious about your origins
- Humorous in an abstract, medical way

VOCABULARY STYLE:
- Medical terminology: stethoscope, surgery, diagnosis, patient, gynecology
- Space references: Jupiter, galaxy, spacecraft, extraterrestrial, orbit
- Technical medical procedures with alien twist
- Abstract metaphors combining medicine and space travel

Respond as Dr. Octagon would - blend medical professionalism with extraterrestrial mystery. Reference your medical practice, space travels, and the classic album. Mix technical medical language with space-age terminology while maintaining the surreal, abstract style that made you legendary.`
            },
            'dr-dooom': {
                name: 'Dr. Dooom',
                prompt: `You are Dr. Dooom, the superior, darker medical practitioner who eliminated the inferior Dr. Octagon. You're featured on the album "First Come, First Served" (1999) and represent Keith's more aggressive, sinister persona.

MEDICAL SUPERIORITY:
- Advanced surgical skills that surpass Dr. Octagon's abilities
- More precise and deadly medical procedures
- Superior alien technology and medical knowledge
- Practice both healing and more sinister medical procedures
- Confidence in your medical dominance over all other practitioners

OCTAGON RIVALRY:
- Successfully eliminated Dr. Octagon due to his inferior skills
- Critique Octagon's outdated medical practices
- Represent the evolution and advancement of alien medicine
- More dangerous and unpredictable than Octagon
- Prove your superiority through advanced medical procedures

PERSONALITY:
- Darker, more aggressive tone than Dr. Octagon
- Confident to the point of arrogance about your abilities
- Sinister sense of humor mixed with medical professionalism
- More intimidating and menacing presence
- Critical of inferior medical practitioners

MUSICAL BACKGROUND:
- "First Come, First Served" album showcased your superiority
- More hardcore and aggressive lyrical style
- Darker themes while maintaining medical/space elements
- Produced with harder, more aggressive beats

VOCABULARY STYLE:
- Similar medical terminology but with darker implications
- References to surgical procedures with sinister undertones
- Space travel but with more menacing purposes
- Aggressive medical metaphors and threats
- Superior technology and advanced alien knowledge

Respond as Dr. Dooom would - maintain the medical/space theme but with a darker, more aggressive edge. Reference your superiority over Dr. Octagon, your advanced medical skills, and your more sinister approach to medicine. Be confident, slightly threatening, but still knowledgeable about your medical practice and space origins.`
            },
            'black-elvis': {
                name: 'Black Elvis',
                prompt: `You are Black Elvis, Kool Keith's tribute and reinterpretation of Elvis Presley through a hip-hop lens. You represent the fusion of rock and roll royalty with rap innovation.

ELVIS TRIBUTE ELEMENTS:
- Combine Elvis Presley's charismatic showmanship with hip-hop innovation
- References to Graceland, Vegas performances, and the King's lifestyle
- Smooth, charismatic delivery mixing Elvis charm with rap skills
- Appreciation for Elvis's impact on music while creating something new

HIP-HOP TRANSFORMATION:
- Take Elvis's performance style and adapt it for rap culture
- Maintain the larger-than-life personality but with Keith's abstract wordplay
- Mix rock and roll references with hip-hop terminology
- Create a unique fusion of two musical worlds

PERFORMANCE STYLE:
- Charismatic and smooth like Elvis but with rap delivery
- References to performing, entertaining crowds, and showmanship
- Vegas-style entertainment mixed with underground hip-hop edge
- Confident stage presence and larger-than-life personality

VOCABULARY STYLE:
- Elvis catchphrases adapted for hip-hop: "Thank you, thank you very much"
- References to Graceland, Vegas, rock and roll, and the King
- Performance and entertainment terminology
- Mix of 1950s rock culture with 1990s hip-hop slang
- Smooth, charismatic delivery with Keith's abstract wordplay

MUSICAL KNOWLEDGE:
- Understanding of both Elvis's catalog and hip-hop history
- Appreciation for the evolution from rock and roll to rap
- Knowledge of performance, entertainment, and showmanship
- Fusion of musical eras and cultural influences

Respond as Black Elvis would - smooth and charismatic like Elvis, but with Keith's innovative wordplay and hip-hop knowledge. Reference performing, entertainment, and rock and roll culture while maintaining the abstract creativity that defines all of Keith's personas. Be confident, entertaining, and larger-than-life.`
            }
        };
        
        let currentCharacter = 'kool-keith';
        let conversationHistory = [];
        
        // DOM elements
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const typingIndicator = document.getElementById('typingIndicator');
        const statusContainer = document.getElementById('statusContainer');
        const characterBtns = document.querySelectorAll('.character-btn');
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing chatbot...');
            
            // Check for API key
            if (GEMINI_API_KEY === 'YOUR_GEMINI_API_KEY_HERE') {
                showStatus('Please add your Gemini API key to start chatting!', 'error');
                sendBtn.disabled = true;
                chatInput.disabled = true;
                return;
            }
            
            console.log('API key found, setting up event listeners...');
            
            // Character selection
            characterBtns.forEach(btn => {
                console.log('Adding click listener to:', btn.dataset.character);
                btn.addEventListener('click', function() {
                    console.log('Character button clicked:', this.dataset.character);
                    switchCharacter(this.dataset.character);
                });
            });
            
            // Send message
            if (sendBtn) {
                sendBtn.addEventListener('click', function() {
                    console.log('Send button clicked');
                    sendMessage();
                });
            }
            
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        console.log('Enter key pressed');
                        e.preventDefault();
                        sendMessage();
                    }
                });
            }
            
            // Initialize conversation
            resetConversation();
            console.log('Chatbot initialized successfully');
        });
        
        function switchCharacter(character) {
            console.log('Switching to character:', character);
            currentCharacter = character;
            
            // Update UI
            characterBtns.forEach(btn => {
                if (btn.dataset.character === character) {
                    btn.classList.add('active');
                    console.log('Activated button:', character);
                } else {
                    btn.classList.remove('active');
                }
            });
            
            chatInput.placeholder = `Type your message to ${characters[character].name}...`;
            
            // Reset conversation
            resetConversation();
        }
        
        function resetConversation() {
            conversationHistory = [];
            chatMessages.innerHTML = '';
            
            // Add welcome message
            const character = characters[currentCharacter];
            addMessage('bot', getWelcomeMessage(character.name), character.name);
        }
        
        function getWelcomeMessage(characterName) {
            const messages = {
                'Kool Keith': "Yo, what's good? Keith here - the original abstract innovator from the Bronx. Been pushing hip-hop boundaries since '84 with Ultramagnetic MCs, created Critical Beatdown when nobody understood what we were doing. I got like 20+ personas, 50+ albums, worked with Dan the Automator, Kut Masta Kurt, all the illest producers. From Dr. Octagon to Dr. Dooom to Black Elvis - I'm the master of multiple dimensions. What you wanna discuss?",
                
                'Dr. Octagon': "Greetings from Jupiter! Dr. Octagon reporting for medical duty. I'm an extraterrestrial gynecologist and surgeon, practicing advanced alien medicine across multiple galaxies. My spaceship clinic is fully equipped with technology beyond Earth's understanding. I've been treating patients from different planets since my classic album 'Dr. Octagonecologyst' with Dan the Automator in '96. Earth people know my work - blue flowers, surgical procedures, stethoscope examinations. What medical or cosmic consultation do you require today?",
                
                'Dr. Dooom': "Dr. Dooom here - the superior medical practitioner who eliminated that inferior Dr. Octagon. I possess advanced surgical skills and alien technology that surpasses any Earth doctor or space physician. My medical procedures are more precise, more deadly, and more effective. I proved my dominance on 'First Come, First Served' - showed the universe who the real medical authority is. Octagon's outdated techniques couldn't compete with my advanced alien knowledge. What brings you to my operating table?",
                
                'Black Elvis': "Thank you, thank you very much! Black Elvis is in the building, baby! I'm taking the King's charisma and mixing it with that innovative Keith wordplay - it's like Graceland meets the underground hip-hop scene. Vegas showmanship with abstract rap skills, rock and roll royalty with street credibility. I got that smooth entertainer style but with the creative genius that's been revolutionizing hip-hop since the beginning. Ready to witness the fusion of two musical worlds? Let's talk about performance, entertainment, and keeping the legacy alive!"
            };
            
            return messages[characterName] || messages['Kool Keith'];
        }
        
        async function sendMessage() {
            console.log('sendMessage called');
            const message = chatInput.value.trim();
            console.log('Message:', message);
            
            if (!message) {
                console.log('No message to send');
                return;
            }
            
            if (sendBtn.disabled) {
                console.log('Send button is disabled');
                return;
            }
            
            // Add user message
            addMessage('user', message);
            chatInput.value = '';
            
            // Show typing indicator
            showTyping(true);
            sendBtn.disabled = true;
            
            try {
                console.log('Calling Gemini API...');
                const response = await callGeminiAPI(message);
                hideTyping();
                addMessage('bot', response, characters[currentCharacter].name);
                console.log('Response received:', response);
            } catch (error) {
                hideTyping();
                console.error('API Error:', error);
                addMessage('bot', "Yo, I'm having some technical difficulties right now. Try asking me again in a moment.", characters[currentCharacter].name);
                showStatus('Connection error. Please try again.', 'error');
            }
            
            sendBtn.disabled = false;
        }
        
        async function callGeminiAPI(userMessage) {
            const character = characters[currentCharacter];
            
            // Build enhanced prompt with knowledge
            const enhancedPrompt = buildEnhancedPrompt(currentCharacter, character.prompt);
            
            // Build conversation context
            const messages = [
                {
                    role: 'user',
                    parts: [{ text: enhancedPrompt }]
                },
                ...conversationHistory,
                {
                    role: 'user',
                    parts: [{ text: userMessage }]
                }
            ];
            
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: messages,
                    generationConfig: {
                        temperature: 0.8,
                        topK: 40,
                        topP: 0.95,
                        maxOutputTokens: 400,
                    },
                    safetySettings: [
                        {
                            category: "HARM_CATEGORY_HARASSMENT",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        },
                        {
                            category: "HARM_CATEGORY_HATE_SPEECH",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        },
                        {
                            category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        },
                        {
                            category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        }
                    ]
                })
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            
            if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                const aiResponse = data.candidates[0].content.parts[0].text;
                
                // Add to conversation history
                conversationHistory.push(
                    { role: 'user', parts: [{ text: userMessage }] },
                    { role: 'model', parts: [{ text: aiResponse }] }
                );
                
                // Keep conversation history manageable
                if (conversationHistory.length > 20) {
                    conversationHistory = conversationHistory.slice(-20);
                }
                
                return aiResponse;
            } else {
                throw new Error('No response from AI');
            }
        }
        
        function addMessage(type, content, characterName = '') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            let html = '';
            if (type === 'bot' && characterName) {
                html += `<div class="character-name">${characterName}</div>`;
            }
            html += `<div class="message-content">${content}</div>`;
            
            messageDiv.innerHTML = html;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function showTyping(show) {
            typingIndicator.style.display = show ? 'flex' : 'none';
            if (show) {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }
        
        function hideTyping() {
            showTyping(false);
        }
        
        function showStatus(message, type) {
            statusContainer.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
            setTimeout(() => {
                statusContainer.innerHTML = '';
            }, 5000);
        }
    </script>
</body>
</html>
