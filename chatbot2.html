<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>KeithGPT v9 - AI Chat Interface</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;700;900&display=swap');
:root{--primary-gold:#ffd700;--primary-gold-light:#ffed4e;--primary-gold-dim:rgba(255,215,0,0.7);--primary-gold-subtle:rgba(255,215,0,0.1);--bg-primary:#0a0a0a;--bg-secondary:#1a1a1a;--bg-tertiary:#2a2a2a;--bg-chat:#0f0f0f;--bg-sidebar:#111111;--text-primary:#ffffff;--text-secondary:#cccccc;--text-tertiary:#999999;--border-color:rgba(255,255,255,0.1);--border-gold:rgba(255,215,0,0.3);--radius-sm:6px;--radius-md:12px;--radius-lg:16px;--sidebar-width:320px}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',sans-serif;background:var(--bg-primary);color:var(--text-primary);height:100vh;overflow:hidden}
.entry-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:var(--bg-primary);display:flex;align-items:center;justify-content:center;z-index:1000;transition:opacity 0.5s ease}
.entry-overlay.fade-out{opacity:0;pointer-events:none}
.entry-content{text-align:center;max-width:400px;padding:20px}
.entry-logo{max-width:95vw;max-height:60vh;border:1px solid var(--primary-gold);margin:20px auto;display:block}
.entry-title{font-family:'Orbitron',monospace;font-size:28px;font-weight:900;background:linear-gradient(45deg,var(--primary-gold),var(--primary-gold-light));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:10px}
.entry-subtitle{color:var(--text-secondary);font-size:16px;margin-bottom:15px}
.entry-description{color:var(--text-tertiary);font-size:14px;line-height:1.4;margin-bottom:20px}
.entry-disclaimer{color:var(--text-tertiary);font-size:11px;line-height:1.3;margin-bottom:25px;opacity:0.8}
.entry-btn{background:linear-gradient(135deg,var(--primary-gold),var(--primary-gold-light));color:var(--bg-primary);border:none;padding:12px 30px;border-radius:var(--radius-md);font-weight:600;font-size:14px;cursor:pointer;transition:all 0.2s ease}
.entry-btn:hover{transform:translateY(-1px);box-shadow:0 2px 8px rgba(255,215,0,0.3)}
.app-container{display:flex;height:100vh}
.sidebar{width:var(--sidebar-width);background:var(--bg-sidebar);border-right:1px solid var(--border-color);display:flex;flex-direction:column;position:relative;z-index:20;transition:transform 0.3s ease}
.sidebar-header{padding:16px;border-bottom:1px solid var(--border-color)}
.logo{font-family:'Orbitron',monospace;font-size:20px;font-weight:900;background:linear-gradient(45deg,var(--primary-gold),var(--primary-gold-light));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-align:center}
.version{text-align:center;font-size:10px;color:var(--text-tertiary);margin-top:4px}
.new-chat-btn{width:100%;padding:12px 16px;background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:var(--radius-md);color:var(--text-primary);font-size:14px;cursor:pointer;margin-top:12px;display:flex;align-items:center;justify-content:center;gap:8px;transition:all 0.2s ease}
.new-chat-btn:hover{background:var(--bg-secondary);border-color:var(--border-gold)}
.mode-section{padding:16px;border-bottom:1px solid var(--border-color)}
.section-title{font-size:12px;font-weight:600;color:var(--text-tertiary);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:12px}
.mode-toggle{display:flex;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);overflow:hidden}
.mode-btn{flex:1;padding:10px 12px;background:transparent;border:none;color:var(--text-secondary);font-size:13px;cursor:pointer;transition:all 0.2s ease}
.mode-btn.active{background:var(--primary-gold);color:var(--bg-primary);font-weight:600}
.persona-section{padding:16px;border-bottom:1px solid var(--border-color)}
.persona-dropdown{position:relative}
.persona-selected{width:100%;padding:12px 16px;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);color:var(--text-primary);cursor:pointer;display:flex;align-items:center;gap:12px;transition:all 0.2s ease}
.persona-selected:hover{border-color:var(--border-gold)}
.persona-avatar{width:32px;height:32px;border-radius:50%;border:2px solid var(--primary-gold-dim)}
.persona-info{flex:1}
.persona-name{font-weight:600;font-size:14px}
.persona-status{font-size:12px;color:var(--text-tertiary)}
.dropdown-arrow{width:16px;height:16px;fill:var(--text-tertiary);transition:transform 0.2s ease}
.persona-dropdown.open .dropdown-arrow{transform:rotate(180deg)}
.persona-options{position:absolute;top:100%;left:0;right:0;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);margin-top:4px;max-height:0;overflow:hidden;transition:max-height 0.3s ease;z-index:10;box-shadow:0 8px 25px rgba(0,0,0,0.5)}
.persona-dropdown.open .persona-options{max-height:300px}
.persona-option{padding:12px 16px;display:flex;align-items:center;gap:12px;cursor:pointer;border-bottom:1px solid var(--border-color);transition:background 0.2s ease}
.persona-option:hover{background:var(--bg-tertiary)}
.persona-option.active{background:var(--primary-gold-subtle);border-left:3px solid var(--primary-gold)}
.battle-section{padding:16px;border-bottom:1px solid var(--border-color);display:none}
.battle-section.active{display:block}
.battle-controls{display:flex;flex-direction:column;gap:12px}
.battle-dropdowns{display:flex;gap:8px;align-items:center}
.battle-dropdown{flex:1;position:relative}
.battle-selected{width:100%;padding:10px 12px;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-primary);font-size:12px;cursor:pointer;text-align:center;transition:all 0.2s ease}
.battle-selected:hover{border-color:var(--border-gold)}
.battle-vs{font-weight:bold;color:var(--primary-gold);font-size:12px;min-width:30px;text-align:center}
.battle-options{position:absolute;top:100%;left:0;right:0;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-sm);margin-top:4px;max-height:0;overflow:hidden;transition:max-height 0.3s ease;z-index:15;box-shadow:0 4px 12px rgba(0,0,0,0.4)}
.battle-dropdown.open .battle-options{max-height:200px}
.battle-option{padding:8px 12px;cursor:pointer;font-size:12px;text-align:center;transition:background 0.2s ease}
.battle-option:hover{background:var(--bg-tertiary)}
.start-battle-btn{padding:10px 16px;background:linear-gradient(135deg,var(--primary-gold),var(--primary-gold-light));color:var(--bg-primary);border:none;border-radius:var(--radius-sm);font-weight:600;font-size:12px;cursor:pointer;transition:all 0.2s ease}
.start-battle-btn:hover{transform:translateY(-1px);box-shadow:0 1px 3px rgba(0,0,0,0.3)}
.chat-history{flex:1;padding:16px;overflow-y:auto}
.history-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.close-sidebar-btn{display:none;width:32px;height:32px;background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-secondary);cursor:pointer;align-items:center;justify-content:center;transition:all 0.2s ease}
.close-sidebar-btn:hover{background:var(--bg-primary);color:var(--primary-gold)}
.main-content{flex:1;display:flex;flex-direction:column;background:var(--bg-chat)}
.chat-header{height:60px;background:var(--bg-secondary);border-bottom:1px solid var(--border-color);display:flex;align-items:center;justify-content:space-between;padding:0 24px}
.current-persona{display:flex;align-items:center;gap:12px}
.header-avatar{width:36px;height:36px;border-radius:50%;border:2px solid var(--primary-gold-dim)}
.header-info h3{font-size:16px;font-weight:600}
.header-info p{font-size:12px;color:var(--text-tertiary)}
.mobile-toggle{display:none;width:44px;height:44px;background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-primary);cursor:pointer;align-items:center;justify-content:center}
.battle-status,.error-message{padding:12px;margin:16px 24px;text-align:center;font-size:14px;border-radius:var(--radius-md);display:none}
.battle-status{background:var(--bg-tertiary);border:1px solid var(--border-gold);color:var(--primary-gold)}
.error-message{background:rgba(255,100,100,0.1);border:1px solid rgba(255,100,100,0.3);color:#ff6464}
.battle-status.active,.error-message.active{display:block}
.chat-messages{flex:1;overflow-y:auto;padding:24px;display:flex;flex-direction:column;gap:20px}
.message{display:flex;align-items:flex-start;gap:16px;max-width:85%;animation:messageSlide 0.3s ease-out}
.message.user{align-self:flex-end;flex-direction:row-reverse}
.message.battle{max-width:90%;background:rgba(255,215,0,0.05);border:1px solid rgba(255,215,0,0.2);border-radius:var(--radius-lg);padding:16px;margin:8px 0;align-self:stretch}
.message.system{align-self:center;max-width:70%}
.message-avatar{width:80px;height:80px;border-radius:50%;border:3px solid var(--primary-gold-dim);flex-shrink:0}
.message-content{background:var(--bg-secondary);padding:16px 20px;border-radius:var(--radius-lg);line-height:1.5;font-size:14px;border:1px solid var(--border-color);flex:1;white-space:pre-wrap;word-wrap:break-word}
.message.user .message-content{background:linear-gradient(135deg,var(--primary-gold),var(--primary-gold-light));color:var(--bg-primary);border-color:var(--primary-gold);font-weight:500}
.message.battle .message-content{background:transparent;border:none;padding:0;font-size:15px;font-weight:500;line-height:1.6;color:var(--text-primary)}
.message.system .message-content{background:var(--bg-tertiary);border-left:4px solid var(--primary-gold);text-align:center;font-weight:500}
.battle-header{display:flex;align-items:center;gap:8px;margin-bottom:12px;font-size:12px;color:var(--text-tertiary)}
.battle-round{background:var(--primary-gold);color:var(--bg-primary);padding:4px 12px;border-radius:12px;font-weight:600;font-size:11px}
.battle-character{color:var(--primary-gold);font-weight:600;font-size:14px}
.typing-indicator{display:none;align-items:center;gap:16px;padding:16px 24px;color:var(--text-tertiary);font-size:14px}
.typing-dots{display:flex;gap:4px}
.typing-dot{width:6px;height:6px;background:var(--primary-gold);border-radius:50%;animation:typingBounce 1.4s infinite}
.typing-dot:nth-child(2){animation-delay:0.2s}
.typing-dot:nth-child(3){animation-delay:0.4s}
@keyframes typingBounce{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-8px)}}
.chat-input-area{padding:20px 24px;background:var(--bg-secondary);border-top:1px solid var(--border-color)}
.input-container{position:relative;max-width:800px;margin:0 auto}
.chat-input{width:100%;min-height:50px;max-height:120px;padding:14px 60px 14px 16px;background:var(--bg-primary);border:1px solid var(--border-color);border-radius:var(--radius-lg);color:var(--text-primary);font-size:14px;resize:none;outline:none;transition:all 0.2s ease}
.chat-input:focus{border-color:var(--border-gold);box-shadow:0 0 0 3px var(--primary-gold-subtle)}
.chat-input::placeholder{color:var(--text-tertiary)}
.send-btn{position:absolute;right:8px;top:50%;transform:translateY(-50%);width:40px;height:40px;background:var(--primary-gold);border:none;border-radius:var(--radius-sm);color:var(--bg-primary);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease}
.send-btn:hover{background:var(--primary-gold-light)}
.send-btn:disabled{opacity:0.5;cursor:not-allowed}
.mobile-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:15}
@media (max-width:768px){.sidebar{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:25;transform:translateX(-100%)}.sidebar.open{transform:translateX(0)}.mobile-overlay.show{display:block}.mobile-toggle{display:flex}.close-sidebar-btn{display:flex}.chat-header{padding:0 16px}.chat-messages{padding:16px;gap:16px}.chat-input-area{padding:16px}.message{max-width:95%;gap:12px}.message-avatar{width:60px;height:60px}.message-content{padding:12px 16px;font-size:13px}.chat-input{font-size:16px;padding:12px 50px 12px 14px}.send-btn{width:36px;height:36px}.message.battle{max-width:98%;padding:12px}.message.battle .message-content{font-size:12px;line-height:1.4}}
@keyframes messageSlide{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:var(--bg-secondary)}::-webkit-scrollbar-thumb{background:var(--bg-tertiary);border-radius:3px}::-webkit-scrollbar-thumb:hover{background:var(--primary-gold-dim)}
</style>
</head>
<body>
<div class="entry-overlay" id="entryOverlay">
<div class="entry-content">
<h1 class="entry-title">KEITHGPT</h1>
<img src="aikeith.png" alt="AI Keith" class="entry-logo" onerror="this.style.display='none'">
<p class="entry-subtitle">Galaxy Persona Transformer</p>
<p class="entry-disclaimer">Entertainment purposes only. All responses are AI-generated and may not reflect actual views.</p>
<button class="entry-btn" onclick="enterKeithGPT()">Enter KeithGPT</button>
</div>
</div>
<div class="app-container">
<aside class="sidebar" id="sidebar">
<div class="sidebar-header">
<div class="logo">KEITHGPT</div>
<div class="version">v9 - Bulletproof Edition</div>
<button class="new-chat-btn" id="newChatBtn">
<svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg>
New Chat
</button>
</div>
<div class="mode-section">
<div class="section-title">Chat Mode</div>
<div class="mode-toggle">
<button class="mode-btn active" id="chatModeBtn">Chat</button>
<button class="mode-btn" id="battleModeBtn">Battle</button>
</div>
</div>
<div class="persona-section" id="chatPersonaSection">
<div class="section-title">AI Persona</div>
<div class="persona-dropdown" id="personaDropdown">
<div class="persona-selected" id="personaSelected">
<img src="https://github.com/deeman12345123/ultrakeith-website/blob/main/kk.png?raw=true" alt="Kool Keith" class="persona-avatar" id="selectedAvatar">
<div class="persona-info">
<div class="persona-name" id="selectedName">Kool Keith</div>
<div class="persona-status">Abstract innovator</div>
</div>
<svg class="dropdown-arrow" viewBox="0 0 16 16"><path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/></svg>
</div>
<div class="persona-options" id="personaOptions">
<div class="persona-option active" data-character="kool-keith">
<img src="https://github.com/deeman12345123/ultrakeith-website/blob/main/kk.png?raw=true" alt="Kool Keith" class="persona-avatar">
<div class="persona-info">
<div class="persona-name">Kool Keith</div>
<div class="persona-status">Abstract innovator</div>
</div>
</div>
<div class="persona-option" data-character="dr-octagon">
<img src="https://github.com/deeman12345123/ultrakeith-website/blob/main/droctagon.png?raw=true" alt="Dr. Octagon" class="persona-avatar">
<div class="persona-info">
<div class="persona-name">Dr. Octagon</div>
<div class="persona-status">Cosmic surgeon</div>
</div>
</div>
<div class="persona-option" data-character="dr-dooom">
<img src="https://github.com/deeman12345123/ultrakeith-website/blob/main/drdooom.png?raw=true" alt="Dr. Dooom" class="persona-avatar">
<div class="persona-info">
<div class="persona-name">Dr. Dooom</div>
<div class="persona-status">Industry executioner</div>
</div>
</div>
<div class="persona-option" data-character="black-elvis">
<img src="https://github.com/deeman12345123/ultrakeith-website/blob/main/blackelvis.png?raw=true" alt="Black Elvis" class="persona-avatar">
<div class="persona-info">
<div class="persona-name">Black Elvis</div>
<div class="persona-status">Funk master</div>
</div>
</div>
</div>
</div>
</div>
<div class="battle-section" id="battleSection">
<div class="section-title">Battle Setup</div>
<div class="battle-controls">
<div class="battle-dropdowns">
<div class="battle-dropdown" id="battleDropdown1">
<div class="battle-selected" id="battleSelected1">Kool Keith</div>
<div class="battle-options">
<div class="battle-option" data-character="kool-keith">Kool Keith</div>
<div class="battle-option" data-character="dr-octagon">Dr. Octagon</div>
<div class="battle-option" data-character="dr-dooom">Dr. Dooom</div>
<div class="battle-option" data-character="black-elvis">Black Elvis</div>
<div class="battle-option" data-character="user">You</div>
</div>
</div>
<div class="battle-vs">VS</div>
<div class="battle-dropdown" id="battleDropdown2">
<div class="battle-selected" id="battleSelected2">Dr. Octagon</div>
<div class="battle-options">
<div class="battle-option" data-character="kool-keith">Kool Keith</div>
<div class="battle-option" data-character="dr-octagon">Dr. Octagon</div>
<div class="battle-option" data-character="dr-dooom">Dr. Dooom</div>
<div class="battle-option" data-character="black-elvis">Black Elvis</div>
<div class="battle-option" data-character="user">You</div>
</div>
</div>
</div>
<button class="start-battle-btn" id="startBattleBtn">Start Battle</button>
</div>
</div>
<div class="chat-history" id="chatHistory">
<div class="history-header">
<div class="section-title">Recent Chats</div>
<button class="close-sidebar-btn" id="closeSidebarBtn">
<svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/></svg>
</button>
</div>
</div>
</aside>
<div class="mobile-overlay" id="mobileOverlay"></div>
<main class="main-content">
<header class="chat-header">
<button class="mobile-toggle" id="mobileToggle">
<svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/></svg>
</button>
<div class="current-persona">
<img src="https://github.com/deeman12345123/ultrakeith-website/blob/main/kk.png?raw=true" alt="Kool Keith" class="header-avatar" id="headerAvatar">
<div class="header-info">
<h3 id="headerName">Kool Keith</h3>
<p id="headerStatus">Abstract innovator</p>
</div>
</div>
</header>
<div class="battle-status" id="battleStatus">🥊 Battle in progress... Round <span id="currentRound">1</span> of 3</div>
<div class="error-message" id="errorMessage">⚠️ Technical difficulties - trying to reconnect...</div>
<div class="chat-messages" id="chatMessages"></div>
<div class="typing-indicator" id="typingIndicator">
<img src="https://github.com/deeman12345123/ultrakeith-website/blob/main/kk.png?raw=true" alt="Kool Keith" class="message-avatar" id="typingAvatar" style="width:32px;height:32px;">
<span id="typingName">Kool Keith</span> is thinking...
<div class="typing-dots">
<div class="typing-dot"></div>
<div class="typing-dot"></div>
<div class="typing-dot"></div>
</div>
</div>
<div class="chat-input-area">
<div class="input-container">
<textarea class="chat-input" id="chatInput" placeholder="Message KeithGPT..." rows="1" maxlength="1000"></textarea>
<button class="send-btn" id="sendBtn" disabled>
<svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M15.854.146a.5.5 0 0 1 .11.54L13.026 15.147a.5.5 0 0 1-.925-.234l-1.3-5.98-5.98-1.3a.5.5 0 0 1-.234-.925L15.146.037a.5.5 0 0 1 .708.109z"/></svg>
</button>
</div>
</div>
</main>
</div>
<script>
function enterKeithGPT(){const o=document.getElementById('entryOverlay');if(o){o.classList.add('fade-out');setTimeout(()=>{o.style.display='none'},500)}}
function loadKnowledgeFiles(){const files=['keith-knowledge/kool-keith-knowledge.js','keith-knowledge/dr-octagon-knowledge.js','keith-knowledge/dr-dooom-knowledge.js','keith-knowledge/black-elvis-knowledge.js'];files.forEach(file=>{const s=document.createElement('script');s.src=file;s.onerror=()=>console.warn(`Knowledge file not found: ${file}`);document.head.appendChild(s)})}
loadKnowledgeFiles();
const CONFIG={getApiKey:()=>['AIzaSy','DnMpSo','awXZ-_','LE9ZXA','sFJ41J','Xmb','N0VDW0'].join(''),retryAttempts:3,retryDelay:2000,apiTimeout:30000};
const characterData={'kool-keith':{name:'Kool Keith',status:'Abstract innovator',avatar:'https://github.com/deeman12345123/ultrakeith-website/blob/main/kk.png?raw=true'},'dr-octagon':{name:'Dr. Octagon',status:'Cosmic surgeon',avatar:'https://github.com/deeman12345123/ultrakeith-website/blob/main/droctagon.png?raw=true'},'dr-dooom':{name:'Dr. Dooom',status:'Industry executioner',avatar:'https://github.com/deeman12345123/ultrakeith-website/blob/main/drdooom.png?raw=true'},'black-elvis':{name:'Black Elvis',status:'Funk master',avatar:'https://github.com/deeman12345123/ultrakeith-website/blob/main/blackelvis.png?raw=true'}};
const battleTopics=["lyrical supremacy and wordplay mastery","hip-hop innovation and creativity","underground vs mainstream authenticity","New York hip-hop legacy and influence","artistic vision and character development","mic skills and flow techniques"];
function getCharacterKnowledge(character){try{let knowledgeObj;switch(character){case 'kool-keith':knowledgeObj=window.koolKeithKnowledge;break;case 'dr-octagon':knowledgeObj=window.drOctagonKnowledge;break;case 'dr-dooom':knowledgeObj=window.drDooomKnowledge;break;case 'black-elvis':knowledgeObj=window.blackElvisKnowledge;break;default:return getBasicCharacterPrompt(character)}return knowledgeObj?buildCharacterPrompt(knowledgeObj,character):getBasicCharacterPrompt(character)}catch(error){console.warn(`Knowledge error for ${character}:`,error);return getBasicCharacterPrompt(character)}}
function getBasicCharacterPrompt(character){const prompts={'kool-keith':'You are Kool Keith, abstract innovator of hip-hop. Known for surreal lyrics, complex wordplay, and avant-garde creativity. Speak with abstract confidence and innovative flow.','dr-octagon':'You are Dr. Octagon, cosmic surgeon and extraterrestrial hip-hop entity. Known for medical metaphors, space themes, and bizarre surgical scenarios. Speak with cosmic medical authority.','dr-dooom':'You are Dr. Dooom, the industry executioner. Known for harsh criticism of fake rappers and raw, aggressive delivery. Speak with uncompromising directness and industry knowledge.','black-elvis':'You are Black Elvis, funk master mixing hip-hop with rock and funk. Known for genre-blending creativity and rebellious attitude. Speak with funky confidence and musical innovation.'};return prompts[character]||`You are ${character}. Respond authentically as this hip-hop persona.`}
function buildCharacterPrompt(knowledge,character){try{let prompt=`You are ${knowledge.identity?.name||character}.\n\nIDENTITY & BACKGROUND:\n${knowledge.identity?.significance||'Character significance not available'}\nOrigin: ${knowledge.identity?.origin||'Unknown origin'}\nStatus: ${knowledge.identity?.status||'Unknown status'}\n\nPERSONALITY:\nCore traits: ${knowledge.personality?.coreTraits?.join(', ')||'Traits not available'}\nPsychology: ${knowledge.personality?.psychologicalProfile||'Profile not available'}\nMotivations: ${knowledge.personality?.motivations?.join(', ')||'Motivations not available'}\n\nSPEAKING STYLE:\nTone: ${knowledge.speakingStyle?.tone||'Tone not specified'}\nDelivery: ${knowledge.speakingStyle?.delivery||'Delivery not specified'}\n\nKEY THEMES: ${knowledge.themes?.join(', ')||'Themes not available'}\n\nVOCABULARY TO USE:`;if(knowledge.vocabulary){if(knowledge.vocabulary.medical){prompt+=`\n- Medical: ${knowledge.vocabulary.medical.slice(0,10).join(', ')}`}if(knowledge.vocabulary.violence){prompt+=`\n- Violence: ${knowledge.vocabulary.violence.slice(0,10).join(', ')}`}if(knowledge.vocabulary.technical){prompt+=`\n- Technical: ${knowledge.vocabulary.technical.slice(0,10).join(', ')}`}if(knowledge.vocabulary.street){prompt+=`\n- Street: ${knowledge.vocabulary.street.slice(0,10).join(', ')}`}if(knowledge.vocabulary.abstract){prompt+=`\n- Abstract: ${knowledge.vocabulary.abstract.slice(0,10).join(', ')}`}if(knowledge.vocabulary.space){prompt+=`\n- Space: ${knowledge.vocabulary.space.slice(0,10).join(', ')}`}if(knowledge.vocabulary.elvis){prompt+=`\n- Elvis: ${knowledge.vocabulary.elvis.slice(0,10).join(', ')}`}}if(knowledge.responses){prompt+=`\n\nAUTHENTIC RESPONSE EXAMPLES:`;Object.keys(knowledge.responses).forEach(category=>{if(knowledge.responses[category].medium){prompt+=`\n${category.toUpperCase()}: "${knowledge.responses[category].medium[0]}"`}})}if(knowledge.likes){prompt+=`\n\nLIKES: ${knowledge.likes.slice(0,8).join(', ')}`}if(knowledge.dislikes){prompt+=`\n\nDISLIKES: ${knowledge.dislikes.slice(0,8).join(', ')}`}prompt+=`\n\nRemember: Stay completely authentic to this character's documented personality, vocabulary, and style.`;return prompt}catch(error){console.error(`Error building prompt for ${character}:`,error);return getBasicCharacterPrompt(character)}}
let currentCharacter='kool-keith';let conversationHistory=[];let currentMode='chat';let isProcessing=false;let battleState={active:false,fighter1:'kool-keith',fighter2:'dr-octagon',currentRound:1,maxRounds:3,topic:'',nextUp:'fighter1'};
class KeithGPT{constructor(){this.init()}
init(){this.setupEventListeners();this.updatePersonaUI();this.resetConversation();console.log('KeithGPT v9 Bulletproof Edition initialized')}
getElement(id){return document.getElementById(id)}
safeSetText(id,text){const el=this.getElement(id);if(el)el.textContent=text}
safeSetSrc(id,src){const el=this.getElement(id);if(el)el.src=src}
safeToggleClass(id,className,condition){const el=this.getElement(id);if(el)el.classList.toggle(className,condition)}
showError(message,duration=5000){const errorEl=this.getElement('errorMessage');if(errorEl){errorEl.textContent=`⚠️ ${message}`;errorEl.classList.add('active');setTimeout(()=>errorEl.classList.remove('active'),duration)}}
hideError(){this.safeToggleClass('errorMessage','active',false)}
setupEventListeners(){const chatModeBtn=this.getElement('chatModeBtn');const battleModeBtn=this.getElement('battleModeBtn');if(chatModeBtn)chatModeBtn.addEventListener('click',()=>this.setMode('chat'));if(battleModeBtn)battleModeBtn.addEventListener('click',()=>this.setMode('battle'));const personaSelected=this.getElement('personaSelected');if(personaSelected)personaSelected.addEventListener('click',()=>this.togglePersonaDropdown());const startBattleBtn=this.getElement('startBattleBtn');if(startBattleBtn)startBattleBtn.addEventListener('click',()=>this.startBattle());const battleSelected1=this.getElement('battleSelected1');const battleSelected2=this.getElement('battleSelected2');if(battleSelected1)battleSelected1.addEventListener('click',()=>this.toggleBattleDropdown(1));if(battleSelected2)battleSelected2.addEventListener('click',()=>this.toggleBattleDropdown(2));const sendBtn=this.getElement('sendBtn');const newChatBtn=this.getElement('newChatBtn');const mobileToggle=this.getElement('mobileToggle');const closeSidebarBtn=this.getElement('closeSidebarBtn');const mobileOverlay=this.getElement('mobileOverlay');if(sendBtn)sendBtn.addEventListener('click',()=>this.sendMessage());if(newChatBtn)newChatBtn.addEventListener('click',()=>this.resetConversation());if(mobileToggle)mobileToggle.addEventListener('click',()=>this.toggleMobile());if(closeSidebarBtn)closeSidebarBtn.addEventListener('click',()=>this.closeMobile());if(mobileOverlay)mobileOverlay.addEventListener('click',()=>this.closeMobile());document.querySelectorAll('.persona-option').forEach(option=>{option.addEventListener('click',()=>this.switchCharacter(option.dataset.character))});document.querySelectorAll('#battleDropdown1 .battle-option').forEach(option=>{option.addEventListener('click',()=>this.selectBattleFighter(1,option.dataset.character))});document.querySelectorAll('#battleDropdown2 .battle-option').forEach(option=>{option.addEventListener('click',()=>this.selectBattleFighter(2,option.dataset.character))});const chatInput=this.getElement('chatInput');if(chatInput){chatInput.addEventListener('keydown',(e)=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();this.sendMessage()}});chatInput.addEventListener('input',()=>this.handleInputChange())}document.addEventListener('click',(e)=>{if(!e.target.closest('#personaDropdown'))this.closePersonaDropdown();if(!e.target.closest('#battleDropdown1'))this.closeBattleDropdown(1);if(!e.target.closest('#battleDropdown2'))this.closeBattleDropdown(2)})}
setMode(mode){currentMode=mode;this.safeToggleClass('chatModeBtn','active',mode==='chat');this.safeToggleClass('battleModeBtn','active',mode==='battle');const chatSection=this.getElement('chatPersonaSection');if(chatSection)chatSection.style.display=mode==='chat'?'block':'none';this.safeToggleClass('battleSection','active',mode==='battle');if(mode==='chat'){battleState.active=false;this.safeToggleClass('battleStatus','active',false)}this.resetConversation()}
togglePersonaDropdown(){this.safeToggleClass('personaDropdown','open')}
closePersonaDropdown(){this.safeToggleClass('personaDropdown','open',false)}
switchCharacter(character){if(!characterData[character])return;currentCharacter=character;document.querySelectorAll('.persona-option').forEach(option=>{option.classList.toggle('active',option.dataset.character===character)});this.updatePersonaUI();this.closePersonaDropdown();this.resetConversation()}
updatePersonaUI(){const data=characterData[currentCharacter];if(!data)return;this.safeSetSrc('selectedAvatar',data.avatar);this.safeSetText('selectedName',data.name);this.safeSetSrc('headerAvatar',data.avatar);this.safeSetText('headerName',data.name);this.safeSetText('headerStatus',data.status);this.safeSetSrc('typingAvatar',data.avatar);this.safeSetText('typingName',data.name);const chatInput=this.getElement('chatInput');if(chatInput)chatInput.placeholder=`Message ${data.name}...`}
toggleBattleDropdown(num){this.safeToggleClass(`battleDropdown${num}`,'open');const otherNum=num===1?2:1;this.safeToggleClass(`battleDropdown${otherNum}`,'open',false)}
closeBattleDropdown(num){this.safeToggleClass(`battleDropdown${num}`,'open',false)}
selectBattleFighter(num,character){if(num===1)battleState.fighter1=character;else battleState.fighter2=character;const fighterName=character==='user'?'You':(characterData[character]?.name||character);this.safeSetText(`battleSelected${num}`,fighterName);this.closeBattleDropdown(num)}
async startBattle(){if(battleState.fighter1===battleState.fighter2){alert('Please select different fighters!');return}if(isProcessing)return;battleState.active=true;battleState.currentRound=1;battleState.topic=battleTopics[Math.floor(Math.random()*battleTopics.length)];battleState.nextUp='fighter1';this.safeToggleClass('battleStatus','active',true);this.safeSetText('currentRound','1');this.resetConversation();const fighter1Name=battleState.fighter1==='user'?'You':(characterData[battleState.fighter1]?.name||battleState.fighter1);const fighter2Name=battleState.fighter2==='user'?'You':(characterData[battleState.fighter2]?.name||battleState.fighter2);this.addSystemMessage(`🥊 BATTLE ROYALE: ${fighter1Name} vs ${fighter2Name}\n\nTopic: "${battleState.topic}"\n\n3 rounds of lyrical warfare begins NOW!`);setTimeout(()=>this.battleLoop(),1000)}
async battleLoop(){if(battleState.currentRound>battleState.maxRounds){this.addSystemMessage('🏆 BATTLE COMPLETE! Both warriors showed incredible skill!');this.safeToggleClass('battleStatus','active',false);battleState.active=false;return}const fighter=battleState.nextUp==='fighter1'?battleState.fighter1:battleState.fighter2;const fighterName=fighter==='user'?'You':(characterData[fighter]?.name||fighter);if(fighter==='user'){this.addSystemMessage(`Your turn! Drop your verse for round ${battleState.currentRound}`);const chatInput=this.getElement('chatInput');if(chatInput)chatInput.placeholder=`Your battle verse for round ${battleState.currentRound}...`;return}this.showTyping(true,fighter);try{const verse=await this.callWithRetry(()=>this.callBattleAPI(fighter,battleState.topic,battleState.currentRound));this.showTyping(false);this.addBattleMessage(verse,fighterName,battleState.currentRound);this.advanceBattleState();setTimeout(()=>this.battleLoop(),3000)}catch(error){console.error('Battle verse error:',error);this.showTyping(false);this.showError('Battle verse failed, retrying...');setTimeout(()=>this.battleLoop(),2000)}}
advanceBattleState(){if(battleState.nextUp==='fighter1'){battleState.nextUp='fighter2'}else{battleState.nextUp='fighter1';battleState.currentRound++;this.safeSetText('currentRound',battleState.currentRound.toString())}}
async callWithRetry(apiFunction){let lastError;for(let attempt=1;attempt<=CONFIG.retryAttempts;attempt++){try{const result=await apiFunction();this.hideError();return result}catch(error){lastError=error;console.warn(`API attempt ${attempt} failed:`,error.message);if(attempt<CONFIG.retryAttempts){this.showError(`Connection issue, retrying... (${attempt}/${CONFIG.retryAttempts})`);await new Promise(resolve=>setTimeout(resolve,CONFIG.retryDelay*attempt))}}}throw lastError}
async callChatAPI(userMessage){const apiKey=CONFIG.getApiKey();if(!apiKey)throw new Error('API configuration error');const characterKnowledge=getCharacterKnowledge(currentCharacter);const prompt=`${characterKnowledge}\n\nBased on the above knowledge, respond to the user as this character. Stay authentic to their documented personality, style, vocabulary, and themes.\n\nUser message: ${userMessage}\n\nResponse as character:`;const messages=[{role:'user',parts:[{text:prompt}]},...conversationHistory.slice(-6)];const controller=new AbortController();const timeoutId=setTimeout(()=>controller.abort(),CONFIG.apiTimeout);try{const response=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:messages,generationConfig:{temperature:0.8,topK:40,topP:0.95,maxOutputTokens:400},safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"}]}),signal:controller.signal});if(!response.ok)throw new Error(`HTTP error! status: ${response.status}`);const data=await response.json();if(data.candidates?.[0]?.content){const aiResponse=data.candidates[0].content.parts[0].text;conversationHistory.push({role:'user',parts:[{text:userMessage}]},{role:'model',parts:[{text:aiResponse}]});if(conversationHistory.length>20){conversationHistory=conversationHistory.slice(-20)}return aiResponse}else{throw new Error('No response content from AI')}}finally{clearTimeout(timeoutId)}}
async callBattleAPI(character,topic,round){const apiKey=CONFIG.getApiKey();if(!apiKey)throw new Error('API configuration error');const characterName=characterData[character]?.name||character;const prompt=`CRITICAL: DO NOT start with "Yo, check the mic" or "one two" or "this ain't no" - BANNED PHRASES!\n\nYou are ${characterName}. Write a 4-line rap battle verse with proper rhymes that flows naturally. Start immediately with your authentic character voice.\n\nBattle topic: ${topic}\nRound: ${round}\n\nWrite your verse now:`;const controller=new AbortController();const timeoutId=setTimeout(()=>controller.abort(),CONFIG.apiTimeout);try{const response=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{role:'user',parts:[{text:prompt}]}],generationConfig:{temperature:1.0,topK:40,topP:0.9,maxOutputTokens:150},safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"}]}),signal:controller.signal});if(!response.ok)throw new Error(`API Error: ${response.status}`);const data=await response.json();if(data.candidates?.[0]?.content){return data.candidates[0].content.parts[0].text}else{throw new Error('No battle verse content in API response')}}finally{clearTimeout(timeoutId)}}
async sendMessage(){const chatInput=this.getElement('chatInput');const sendBtn=this.getElement('sendBtn');if(!chatInput||!sendBtn)return;const message=chatInput.value.trim();if(!message||sendBtn.disabled||isProcessing)return;isProcessing=true;this.addUserMessage(message);chatInput.value='';this.handleInputChange();if(battleState.active){const currentFighter=battleState.nextUp==='fighter1'?battleState.fighter1:battleState.fighter2;if(currentFighter==='user'){this.addBattleMessage(message,'You',battleState.currentRound);this.advanceBattleState();isProcessing=false;setTimeout(()=>this.battleLoop(),1500);return}}this.showTyping(true);try{const response=await this.callWithRetry(()=>this.callChatAPI(message));this.showTyping(false);this.addBotMessage(response)}catch(error){this.showTyping(false);console.error('Chat API Error:',error);this.showError('Connection failed - please try again');this.addBotMessage("I'm having trouble connecting right now. Please try again in a moment.")}finally{isProcessing=false}}
addSystemMessage(content){const messageDiv=document.createElement('div');messageDiv.className='message system';messageDiv.innerHTML=`<div class="message-content">${this.escapeHtml(content)}</div>`;this.appendMessage(messageDiv)}
addBattleMessage(content,characterName,round){const messageDiv=document.createElement('div');messageDiv.className='message battle';messageDiv.innerHTML=`<div class="battle-header"><span class="battle-round">Round ${round}</span><span class="battle-character">${this.escapeHtml(characterName)}</span></div><div class="message-content">${this.escapeHtml(content)}</div>`;this.appendMessage(messageDiv)}
addUserMessage(content){const userAvatar='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIGZpbGw9IiNjY2NjY2MiIHZpZXdCb3g9IjAgMCAxNiAxNiI+PHBhdGggZD0iTTggOGEzIDMgMCAxIDAgMC02IDMgMyAwIDAgMCAwIDZ6bTItM2EyIDIgMCAxIDEtNCAwIDIgMiAwIDAgMSA0IDB6bTQgOGMwIDEtMSAxLTEgMUgzcy0xIDAtMS0xIDEtNCA2LTQgNiAzIDYgNHoiLz48L3N2Zz4=';const messageDiv=document.createElement('div');messageDiv.className='message user';messageDiv.innerHTML=`<img src="${userAvatar}" alt="You" class="message-avatar"><div style="flex: 1;"><div class="message-content">${this.escapeHtml(content)}</div></div>`;this.appendMessage(messageDiv)}
addBotMessage(content){const data=characterData[currentCharacter];if(data){const messageDiv=document.createElement('div');messageDiv.className='message bot';messageDiv.innerHTML=`<img src="${data.avatar}" alt="${data.name}" class="message-avatar"><div style="flex: 1;"><div class="message-content">${this.escapeHtml(content)}</div></div>`;this.appendMessage(messageDiv)}}
appendMessage(messageDiv){const chatMessages=this.getElement('chatMessages');if(chatMessages){chatMessages.appendChild(messageDiv);this.scrollToBottom()}}
escapeHtml(text){const div=document.createElement('div');div.textContent=text;return div.innerHTML}
showTyping(show=true,character=null){const typingIndicator=this.getElement('typingIndicator');if(typingIndicator){typingIndicator.style.display=show?'flex':'none';if(show&&character&&characterData[character]){this.safeSetSrc('typingAvatar',characterData[character].avatar);this.safeSetText('typingName',characterData[character].name)}if(show)this.scrollToBottom()}}
scrollToBottom(){const chatMessages=this.getElement('chatMessages');if(chatMessages){setTimeout(()=>{chatMessages.scrollTop=chatMessages.scrollHeight},100)}}
handleInputChange(){const chatInput=this.getElement('chatInput');const sendBtn=this.getElement('sendBtn');if(chatInput&&sendBtn){const hasText=chatInput.value.trim().length>0;sendBtn.disabled=!hasText||isProcessing}}
resetConversation(){conversationHistory=[];const chatMessages=this.getElement('chatMessages');if(chatMessages)chatMessages.innerHTML='';if(currentMode==='chat'){const data=characterData[currentCharacter];if(data){const welcomeMessage=`Yo, what's good? ${data.name} here - ready to chat! KeithGPT v9 Bulletproof Edition is loaded with enhanced knowledge.`;this.addBotMessage(welcomeMessage)}}battleState.active=false;this.safeToggleClass('battleStatus','active',false);const chatInput=this.getElement('chatInput');const data=characterData[currentCharacter];if(chatInput&&data){chatInput.placeholder=`Message ${data.name}...`}}
toggleMobile(){this.safeToggleClass('sidebar','open');this.safeToggleClass('mobileOverlay','show')}
closeMobile(){this.safeToggleClass('sidebar','open',false);this.safeToggleClass('mobileOverlay','show',false)}}
let app;document.addEventListener('DOMContentLoaded',()=>{try{app=new KeithGPT()}catch(error){console.error('KeithGPT initialization failed:',error);document.body.innerHTML=`<div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: #0a0a0a; color: #fff; font-family: Arial, sans-serif;"><div style="text-align: center;"><h1 style="color: #ffd700;">KeithGPT Failed to Load</h1><p>Please refresh the page</p></div></div>`}});
function handleViewportChange(){let vh=window.innerHeight*0.01;document.documentElement.style.setProperty('--vh',`${vh}px`)}
window.addEventListener('resize',handleViewportChange);window.addEventListener('orientationchange',handleViewportChange);handleViewportChange();
window.addEventListener('error',(event)=>{console.error('Global error:',event.error);if(app&&app.showError){app.showError('Something went wrong - please refresh if issues persist')}});
window.addEventListener('unhandledrejection',(event)=>{console.error('Unhandled promise rejection:',event.reason);if(app&&app.showError){app.showError('Network error - please check your connection')}});
</script>
</body>
</html>
